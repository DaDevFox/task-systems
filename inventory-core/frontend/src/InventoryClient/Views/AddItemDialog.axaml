<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:InventoryClient.ViewModels"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="600"
             x:Class="InventoryClient.Views.AddItemDialog"
             x:DataType="vm:AddItemDialogViewModel"
             Focusable="True">

  <UserControl.KeyBindings>
    <!-- Global dialog shortcuts -->
    <KeyBinding Gesture="Escape" Command="{Binding CancelCommand}"/>
    <KeyBinding Gesture="Ctrl+Enter" Command="{Binding AddItemCommand}"/>
  </UserControl.KeyBindings>

  <UserControl.Styles>
    <Style Selector="TextBlock.label">
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="0,5,0,2"/>
    </Style>

    <Style Selector="TextBox.input">
      <Setter Property="Margin" Value="0,2,0,8"/>
      <Setter Property="MinHeight" Value="32"/>
    </Style>

    <Style Selector="NumericUpDown.input">
      <Setter Property="Margin" Value="0,2,0,8"/>
      <Setter Property="MinHeight" Value="32"/>
    </Style>
  </UserControl.Styles>

  <Border Background="White" CornerRadius="8" Padding="24" BoxShadow="0 4 12 0 #20000000" MinWidth="450">
    <StackPanel Spacing="16">

      <TextBlock Text="Add New Inventory Item" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center"/>

      <ScrollViewer MaxHeight="400">
        <StackPanel Spacing="8">

          <!-- Item Name -->
          <TextBlock Text="Item Name *" Classes="label"/>
          <TextBox x:Name="ItemNameTextBox"
                   Text="{Binding Name}" 
                   Classes="input"
                   Watermark="Enter item name"
                   TabIndex="1">
            <TextBox.KeyBindings>
              <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
            </TextBox.KeyBindings>
          </TextBox>

          <!-- Description -->
          <TextBlock Text="Description" Classes="label"/>
          <TextBox Text="{Binding Description}" 
                   Classes="input"
                   Height="60" 
                   AcceptsReturn="True"
                   Watermark="Enter item description (optional)"
                   TabIndex="2">
            <TextBox.KeyBindings>
              <KeyBinding Gesture="Ctrl+Enter" Command="{Binding AddItemCommand}"/>
            </TextBox.KeyBindings>
          </TextBox>

          <!-- Initial Level -->
          <TextBlock Text="Initial Level *" Classes="label"/>
          <NumericUpDown Value="{Binding InitialLevel}" 
                         Classes="input"
                         Minimum="0"
                         Maximum="999999"
                         Increment="1"
                         FormatString="F2"
                         TabIndex="3">
            <NumericUpDown.KeyBindings>
              <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
            </NumericUpDown.KeyBindings>
          </NumericUpDown>

          <!-- Max Capacity -->
          <TextBlock Text="Maximum Capacity *" Classes="label"/>
          <NumericUpDown Value="{Binding MaxCapacity}" 
                         Classes="input"
                         Minimum="0"
                         Maximum="999999"
                         Increment="1"
                         FormatString="F2"
                         TabIndex="4">
            <NumericUpDown.KeyBindings>
              <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
            </NumericUpDown.KeyBindings>
          </NumericUpDown>
          
          <!-- Low Stock Threshold -->
          <TextBlock Text="Low Stock Threshold *" Classes="label"/>
          <NumericUpDown Value="{Binding LowStockThreshold}" 
                         Classes="input"
                         Minimum="0"
                         Maximum="999999"
                         Increment="1"
                         FormatString="F2"
                         TabIndex="5">
            <NumericUpDown.KeyBindings>
              <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
            </NumericUpDown.KeyBindings>
          </NumericUpDown>
          
          <!-- Unit ID -->
          <TextBlock Text="Unit Type *" Classes="label"/>
          <ComboBox SelectedItem="{Binding UnitId}" 
                    Classes="input"
                    PlaceholderText="Select unit type"
                    TabIndex="6">
            <ComboBox.KeyBindings>
              <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
            </ComboBox.KeyBindings>
            <ComboBoxItem Content="kg"/>
            <ComboBoxItem Content="lbs"/>
            <ComboBoxItem Content="liters"/>
            <ComboBoxItem Content="gallons"/>
            <ComboBoxItem Content="pieces"/>
            <ComboBoxItem Content="boxes"/>
            <ComboBoxItem Content="meters"/>
            <ComboBoxItem Content="feet"/>
          </ComboBox>
          
          <!-- Dynamic Metadata Section -->
          <TextBlock Text="Additional Properties (Optional)" Classes="label" Margin="0,16,0,8"/>
          <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                  BorderThickness="1" 
                  CornerRadius="4" 
                  Padding="8">
            <StackPanel Spacing="8">
              
              <!-- Dynamic Metadata Items -->
              <ItemsControl ItemsSource="{Binding MetadataItems}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="140,*,Auto" Margin="0,0,0,4">
                      
                      <!-- Key TextBox -->
                      <TextBox Grid.Column="0" 
                               Text="{Binding Key}" 
                               Watermark="Property name"
                               Margin="0,0,4,0"
                               IsEnabled="{Binding !IsDefault}">
                        <TextBox.KeyBindings>
                          <KeyBinding Gesture="Enter" Command="{Binding $parent[UserControl].((vm:AddItemDialogViewModel)DataContext).AddItemCommand}"/>
                        </TextBox.KeyBindings>
                      </TextBox>
                      
                      <!-- Value TextBox -->
                      <TextBox Grid.Column="1" 
                               Text="{Binding Value}" 
                               Watermark="Value"
                               Margin="4,0,4,0">
                        <TextBox.KeyBindings>
                          <KeyBinding Gesture="Enter" Command="{Binding $parent[UserControl].((vm:AddItemDialogViewModel)DataContext).AddItemCommand}"/>
                        </TextBox.KeyBindings>
                      </TextBox>
                      
                      <!-- Remove Button (only for non-default items) -->
                      <Button Grid.Column="2" 
                              Content="âœ•"
                              Padding="6,2"
                              FontSize="12"
                              VerticalAlignment="Center"
                              Command="{Binding $parent[UserControl].((vm:AddItemDialogViewModel)DataContext).RemoveMetadataItemCommand}"
                              CommandParameter="{Binding}"
                              IsVisible="{Binding !IsDefault}"
                              ToolTip.Tip="Remove this property"/>
                      
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              
              <!-- Add New Metadata Button -->
              <Button Content="+ Add Property" 
                      Command="{Binding AddMetadataItemCommand}"
                      HorizontalAlignment="Left"
                      Padding="8,4"
                      FontSize="12"
                      Margin="0,8,0,0"
                      TabIndex="7"/>
              
            </StackPanel>
          </Border>
          
        </StackPanel>
      </ScrollViewer>
      
      <!-- Validation Error -->
      <TextBlock Text="{Binding ValidationError}" 
                 Foreground="Red" 
                 FontSize="12"
                 TextWrapping="Wrap"/>
      
      <!-- Buttons -->
      <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,16,0,0">
        <Button Content="Cancel" 
                Command="{Binding CancelCommand}"
                Padding="12,6" 
                MinWidth="80"
                TabIndex="9">
          <Button.KeyBindings>
            <KeyBinding Gesture="Escape" Command="{Binding CancelCommand}"/>
          </Button.KeyBindings>
        </Button>
        <Button Content="{Binding AddItemButtonText}" 
                Command="{Binding AddItemCommand}"
                Classes="primary" 
                Padding="12,6" 
                MinWidth="80"
                IsEnabled="{Binding IsValid}"
                TabIndex="8"
                IsDefault="True">
          <Button.KeyBindings>
            <KeyBinding Gesture="Enter" Command="{Binding AddItemCommand}"/>
          </Button.KeyBindings>
        </Button>
      </StackPanel>
      
    </StackPanel>
  </Border>
  
</UserControl>


